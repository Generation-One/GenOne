@page "/"
@using GenOne.Blazor.Images
@using SixLabors.ImageSharp
@using SixLabors.ImageSharp.PixelFormats
@using Blurhash.ImageSharp


<BlurhashCanvas Blurhash="@hash"></BlurhashCanvas>

<h1>Hello, world!</h1>


<button onclick="@PickAndShow">Pick</button>
<button onclick="@Clear">Clear</button>

@code{
	StreamImage _image;
	BlurhashCanvas _blurhash;

	private string? hash;


	public void Clear()
	{
		hash = null;
		MainThread.BeginInvokeOnMainThread(StateHasChanged);

	}
    
	public async Task PickAndShow()
	{
		try
		{
			var result = await FilePicker.Default.PickAsync();
			if (result != null)
			{
				if (result.FileName.EndsWith("jpg", StringComparison.OrdinalIgnoreCase) ||
				    result.FileName.EndsWith("png", StringComparison.OrdinalIgnoreCase))
				{
					using var stream = await result.OpenReadAsync();

					var img = Image.Load<Rgb24>(stream);
					hash = Blurhasher.Encode(img, 5, 3);
					

					MainThread.BeginInvokeOnMainThread(StateHasChanged);

					// var ms = new MemoryStream();
					// img.SaveAsBmp(ms);
					// ms.Seek(0, SeekOrigin.Begin);

					// await Task.Delay(5000);
					// _image.Image = ms;
				}
			}
		}
		catch (Exception ex)
		{
	// The user canceled or something went wrong
		}
	}

}